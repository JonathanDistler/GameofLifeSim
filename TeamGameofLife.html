/*needs to be generalized to n different entities, and make sure they don't overlap at the start (should be a simple rule to favor who gets position at start)*/
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Game of Life</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      flex-direction: column;
    }
    table {
      border-collapse: collapse;
    }
    td {
      width: 40px;
      height: 40px;
      background-color: lightgray;
    }
  </style>
</head>
<body>
  <h1 id="simTitle">Game of Life</h1>
  <table id="board">
    
<script>
  const board = document.getElementById("board");
  let size = 8;

  for (let i = 0; i < size; i++) {
    let row = document.createElement("tr");
    for (let j = 0; j < size; j++) {
      let cell = document.createElement("td");
      row.appendChild(cell);
    }
    board.appendChild(row);
  }
</script>
  </table>

  <script>
    let arr = Array.from({ length: 8 }, () => Array(8).fill(0));
    let rowNum = arr.length;
    let colNum = arr[0].length;
    let epoch = 0;
    let numEpochs = 10;
    let countArr = Array.from({ length: 8 }, () => Array(8).fill(0));

    function updateTitle(text) {
      document.getElementById("simTitle").textContent = text;
    }

    function colorChange(i, j, color) {
      let table = document.getElementById("board");
      let cell = table.rows[i].cells[j];
      cell.style.backgroundColor = color;
    }

    function gameSetup(boxSize, i, j, likelihood, color, arr) {
      let team = (color === "blue") ? 1 : 2;
      let increment = Math.floor(boxSize / 2);

      let k_start = Math.max(0, i - increment);
      let k_end   = Math.min(arr.length - 1, i + increment);
      let l_start = Math.max(0, j - increment);
      let l_end   = Math.min(arr[0].length - 1, j + increment);

      for (let k = k_start; k <= k_end; k++) {
        for (let l = l_start; l <= l_end; l++) {
          if (Math.random() <= likelihood) {
            arr[k][l] = team;
            colorChange(k, l, color);
          } else {
            arr[k][l] = 0;
            colorChange(k, l, "lightgray");
          }
        }
      }
    }

    function getNeighborCounts(i, j, arr) {
      let blue = 0, green = 0;
      for (let k = i - 1; k <= i + 1; k++) {
        for (let l = j - 1; l <= j + 1; l++) {
          if ((k !== i || l !== j) && k >= 0 && k < rowNum && l >= 0 && l < colNum) {
            if (arr[k][l] === 1) blue++;
            if (arr[k][l] === 2) green++;
          }
        }
      }
      return { blue, green };
    }

    updateTitle(`Epoch Number ${epoch}`);

    gameSetup(3, 2, 2, 0.5, "blue", arr);
    gameSetup(3, 5, 5, 0.5, "green", arr);

    let interval = setInterval(() => {
      epoch++;
      if (epoch > numEpochs) { clearInterval(interval); return; }
      updateTitle(`Epoch Number ${epoch}`);

      let nextArr = arr.map(row => [...row]);

      for (let i = 0; i < rowNum; i++) {
        for (let j = 0; j < colNum; j++) {
          let { blue, green } = getNeighborCounts(i, j, arr);
          let total = blue + green;

          if (arr[i][j] === 1) { // blue
            nextArr[i][j] = (total < 2 || total > 3) ? 0 : 1;
          } else if (arr[i][j] === 2) { // green
            nextArr[i][j] = (total < 2 || total > 3) ? 0 : 2;
          } else { // dead
            if (total === 3) {
              if (blue > green) nextArr[i][j] = 1;
              else if (green > blue) nextArr[i][j] = 2;
              else nextArr[i][j] = Math.random() < 0.5 ? 1 : 2;
            }
          }

          if (nextArr[i][j] !== arr[i][j]) countArr[i][j]++;
        }
      }

      arr = nextArr;

      for (let i = 0; i < rowNum; i++) {
        for (let j = 0; j < colNum; j++) {
          colorChange(i, j, arr[i][j] === 1 ? "blue" :
                              arr[i][j] === 2 ? "green" : "lightgray");
        }
      }
    }, 1000);
  </script>
</body>
</html>
